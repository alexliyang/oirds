FROM rsneddon/fasterrcnn
MAINTAINER Robert Sneddon <581894@bah.com>

# Fixing a couple of scripts
WORKDIR /opt/py-faster-rcnn/lib/fast_rcnn
RUN sed -i 's/__C.USE_GPU_NMS = True/__C.USE_GPU_NMS = False/' config.py

WORKDIR /opt/py-faster-rcnn/tools
RUN sed -i "15iimport matplotlib" demo.py && \
    sed -i "16imatplotlib.use('Agg')" demo.py

# Installing VOC2007, comment out if not needed
WORKDIR /opt/py-faster-rcnn/data

# Extras
RUN sudo apt-get install -y vim emacs
RUN ./scripts/fetch_faster_rcnn_models.sh && \
# ./scripts/fetch_imagenet_models.sh && \
sed -i "121icfg.TRAIN.BBOX_REG = False" ../lib/roi_data_layer/layer.py

WORKDIR /opt
CMD ["bash"]